{"title":"BTSow Spider","date":"2019-10-17T18:26:02.000Z","link":"2019/10/18/BTSow Spider","tags":["BT","Python","Spider"],"updated":"2019-11-02T06:57:45.912Z","content":"<p><img src=\"http://148.70.50.70/source/1571336755404.jpg\" alt=\"image.png\" class=\"article-img\"></p>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import requests</span><br><span class=\"line\">import re</span><br><span class=\"line\">from urllib.parse import quote</span><br><span class=\"line\">from concurrent.futures import ThreadPoolExecutor</span><br><span class=\"line\"></span><br><span class=\"line\">headers = &#123;</span><br><span class=\"line\">        &apos;User-Agent&apos;: &apos;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.131 Safari/537.36&apos;,</span><br><span class=\"line\">        &apos;Origin&apos;: &apos;https://btspread.com&apos;,</span><br><span class=\"line\">        &apos;Connection&apos;: &apos;keep-alive&apos;,</span><br><span class=\"line\">        &apos;Cache-Control&apos;: &apos;max-age=0&apos;,</span><br><span class=\"line\">        &apos;Accept&apos;: &apos;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3&apos;,</span><br><span class=\"line\">        &apos;Host&apos;: &apos;btspread.com&apos;,</span><br><span class=\"line\">        &apos;Accept-Encoding&apos;: &apos;gzip, deflate, br&apos;,</span><br><span class=\"line\">        &apos;Accept-Language&apos;: &apos;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&apos;,</span><br><span class=\"line\">        # &apos;If-Modified-Since&apos;: &apos;Wed, 16 Oct 2019 18:45:21 GMT&apos;,</span><br><span class=\"line\">        &apos;Upgrade-Insecure-Requests&apos;: &apos;2&apos; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">pool = ThreadPoolExecutor(max_workers = 5)</span><br><span class=\"line\"></span><br><span class=\"line\">def torrent_thread(link):</span><br><span class=\"line\">    res = requests.get(link, headers = headers)</span><br><span class=\"line\">    magnet = re.findall(r&apos;&lt;textarea class=&quot;magnet-link&quot; readonly&gt;(.*?)&lt;/textarea&gt;&lt;/div&gt;&apos;,res.text,re.S)</span><br><span class=\"line\">    name = re.findall(r&apos;&lt;h3&gt;(.*?)&lt;/h3&gt;&apos;,res.text,re.S)</span><br><span class=\"line\">    size = re.findall(r&apos;Content Size:&lt;/div&gt;&lt;div class=&quot;col-md-10 col-sm-9 value&quot;&gt;(.*?)&lt;/div&gt;&apos;,res.text,re.S)</span><br><span class=\"line\">    time = re.findall(r&apos;Convert On:&lt;/div&gt;&lt;div class=&quot;col-md-10 col-sm-9 value&quot;&gt;(.*?)&lt;/div&gt;&apos;,res.text,re.S)</span><br><span class=\"line\">    print(name[0])</span><br><span class=\"line\">    print(size[0])</span><br><span class=\"line\">    print(time[0])</span><br><span class=\"line\">    print(magnet[0])</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">url = &apos;https://btspread.com/search/&apos;+quote(input(&apos;Input the source name.\\n&apos;))</span><br><span class=\"line\"></span><br><span class=\"line\">now_page = requests.get(url, headers = headers).text</span><br><span class=\"line\"></span><br><span class=\"line\">torrent_links = re.findall(r&apos;&lt;a href=&quot;(.*?)&quot; title=&quot;&apos;,now_page)</span><br><span class=\"line\"></span><br><span class=\"line\">for torrent_link in torrent_links:</span><br><span class=\"line\">    pool.submit(torrent_thread,torrent_link)</span><br><span class=\"line\"></span><br><span class=\"line\"># print(url)</span><br><span class=\"line\">while True:</span><br><span class=\"line\">    next_url = re.findall(r&apos;&lt;a name=&quot;nextpage&quot;  href=&quot;(.*?)&quot;&gt;Next&apos;,now_page,re.S)</span><br><span class=\"line\">    if len(next_url) == 0:</span><br><span class=\"line\">        break</span><br><span class=\"line\">    else:</span><br><span class=\"line\">        url = &apos;https://btspread.com&apos;+next_url[0]</span><br><span class=\"line\">    # print(url)</span><br><span class=\"line\">    now_page = requests.get(url, headers = headers).text</span><br><span class=\"line\"></span><br><span class=\"line\">    torrent_links = re.findall(r&apos;&lt;a href=&quot;(.*?)&quot; title=&quot;&apos;,now_page)</span><br><span class=\"line\">    for torrent_link in torrent_links:</span><br><span class=\"line\">        pool.submit(torrent_thread,torrent_link)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># response = requests.get(url,headers = headers)</span><br><span class=\"line\"># print(response.text)</span><br><span class=\"line\"># print(re.findall(r&apos;&lt;textarea class=&quot;magnet-link&quot; readonly&gt;(.*?)&lt;/textarea&gt;&lt;/div&gt;&apos;,response.text,re.S))</span><br></pre></td></tr></table></div></figure>","prev":{"title":"Spring-注入","link":"2019/10/18/Spring-注入"},"next":{"title":"Springboot整合redis","link":"2019/10/17/Springboot整合redis"},"plink":"http://yoursite.com/2019/10/18/BTSow Spider/"}