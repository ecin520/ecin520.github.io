{"title":"SpringBoot Zookeeper Dubbo简单搭建分布式系统","date":"2019-11-17T12:34:54.000Z","link":"2019/11/17/SpringBoot-Zookeeper-Dubbo简单搭建分布式系统","tags":["Dubbo","Java","SpringBoot","Zookeeper"],"updated":"2019-11-17T12:35:51.580Z","content":"<h4 id=\"分布式系统\">分布式系统<a href=\"2019/11/17/SpringBoot-Zookeeper-Dubbo简单搭建分布式系统#分布式系统\"></a></h4><p>随着网站规模的不断扩大，业务的不断发展，系统内部的应用越来越多，常规的垂直应用架构已经无法应对复杂业务带来的各种挑战，传统垂直架构改造的核心就是要对应用进行服务化，实现高内聚低耦合，服务化改造使用的核心技术就是分布式服务框架。那么什么是分布式系统？<br>分布式系统是若干独立计算机的集合，这些计算机对于用户来说就像单个相关系统。<br>分布式系统是建立在网络之上的软件系统。</p>\n<h4 id=\"RPC\">RPC<a href=\"2019/11/17/SpringBoot-Zookeeper-Dubbo简单搭建分布式系统#RPC\"></a></h4><p>RPC指的是远程过程调用，是一种进程间通信的方式，是一种技术思想，它允许调用另一台主机的服务，开发人员却不用关心底层的通信细节。</p>\n<h4 id=\"SpringCloud与Dubbo\">SpringCloud与Dubbo<a href=\"2019/11/17/SpringBoot-Zookeeper-Dubbo简单搭建分布式系统#SpringCloud与Dubbo\"></a></h4><p>SpringCloud拥有强大的生态，Dubbo专注于RPC，在RPC这一块，使用Dubbo较佳。</p>\n<h4 id=\"Dubbo\">Dubbo<a href=\"2019/11/17/SpringBoot-Zookeeper-Dubbo简单搭建分布式系统#Dubbo\"></a></h4><p>Dubbo是一款高性能，轻量级的开源JAVA RPC框架，它提供了三大核心能力：</p>\n<ul>\n<li>面向接口的远程方法调用</li>\n<li>智能容错和负载均衡</li>\n<li>服务自动注册和发现。</li>\n</ul>\n<p><a href=\"http://dubbo.apache.org/zh-cn/index.html\" target=\"_blank\" rel=\"noopener\">Dubbo官网</a></p>\n<h5 id=\"基本概念\">基本概念<a href=\"2019/11/17/SpringBoot-Zookeeper-Dubbo简单搭建分布式系统#基本概念\"></a></h5><p><img src=\"http://148.70.50.70/source/1573990439057.jpg\" alt=\"image.png\" class=\"article-img\"></p>\n<ul>\n<li><p>服务提供者（Provider）：暴露服务的服务提供方，服务提供者在启动时，向注册中心注册自己提供的服务。</p>\n</li>\n<li><p>服务消费者（Consumer）: 调用远程服务的服务消费方，服务消费者在启动时，向注册中心订阅自己所需的服务，服务消费者，从提供者地址列表中，基于软负载均衡算法，选一台提供者进行调用，如果调用失败，再选另一台调用。</p>\n</li>\n<li><p>注册中心（Registry）：注册中心返回服务提供者地址列表给消费者，如果有变更，注册中心将基于长连接推送变更数据给消费者</p>\n</li>\n<li><p>监控中心（Monitor）：服务消费者和提供者，在内存中累计调用次数和调用时间，定时每分钟发送一次统计数据到监控中心</p>\n</li>\n</ul>\n<h5 id=\"调用关系\">调用关系<a href=\"2019/11/17/SpringBoot-Zookeeper-Dubbo简单搭建分布式系统#调用关系\"></a></h5><ul>\n<li><p>服务容器负责启动，加载，运行服务提供者。</p>\n</li>\n<li><p>服务提供者在启动时，向注册中心注册自己提供的服务。</p>\n</li>\n<li><p>服务消费者在启动时，向注册中心订阅自己所需的服务。</p>\n</li>\n<li><p>注册中心返回服务提供者地址列表给消费者，如果有变更，注册中心将基于长连接推送变更数据给消费者。</p>\n</li>\n<li><p>服务消费者，从提供者地址列表中，基于软负载均衡算法，选一台提供者进行调用，如果调用失败，再选另一台调用。</p>\n</li>\n<li><p>服务消费者和提供者，在内存中累计调用次数和调用时间，定时每分钟发送一次统计数据到监控中心。</p>\n<h4 id=\"Zookeeper\"><a href=\"2019/11/17/SpringBoot-Zookeeper-Dubbo简单搭建分布式系统#Zookeeper\" class=\"headerlink\" title=\"Zookeeper\"></a>Zookeeper</h4><p>Zookeeper是Apacahe Hadoop 的子项目，是一个树型的目录服务，支持变更推送，适合作为 Dubbo 服务的注册中心，工业强度较高，可用于生产环境。</p>\n</li>\n</ul>\n<p><img src=\"http://148.70.50.70/source/1573990681272.jpg\" alt=\"image.png\" class=\"article-img\"></p>\n<p><a href=\"http://mirror.bit.edu.cn/apache/zookeeper/zookeeper-3.4.14/\" target=\"_blank\" rel=\"noopener\">Zookeeper下载</a><br>windows和Linux都可适用，首先需要将conf/zoo_sample.cfg文件复制为conf/zoo.cfg</p>\n<p><img src=\"http://148.70.50.70/source/1573991018666.jpg\" alt=\"image.png\" class=\"article-img\"></p>\n<p>然后打开 bin/zkServer.cmd 若不报错则正常运行</p>\n<h4 id=\"SpringBoot整合Zookeeper与Dubbo\">SpringBoot整合Zookeeper与Dubbo<a href=\"2019/11/17/SpringBoot-Zookeeper-Dubbo简单搭建分布式系统#SpringBoot整合Zookeeper与Dubbo\"></a></h4><p>idea创建一个空项目，然后添加两个Module-生产者-消费者</p>\n<p><img src=\"http://148.70.50.70/source/1573991206885.jpg\" alt=\"image.png\" class=\"article-img\"></p>\n<h5 id=\"服务提供者-provider\">服务提供者 provider<a href=\"2019/11/17/SpringBoot-Zookeeper-Dubbo简单搭建分布式系统#服务提供者-provider\"></a></h5><h6 id=\"在pom-xml中添加依赖\">在pom.xml中添加依赖<a href=\"2019/11/17/SpringBoot-Zookeeper-Dubbo简单搭建分布式系统#在pom-xml中添加依赖\"></a></h6><figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- Dubbo Spring Boot Starter --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.dubbo<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>dubbo-spring-boot-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.7.3<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- https://mvnrepository.com/artifact/com.github.sgroschupf/zkclient --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.github.sgroschupf<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>zkclient<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- 引入zookeeper --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.curator<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>curator-framework<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.12.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.curator<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>curator-recipes<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.12.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.zookeeper<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>zookeeper<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.4.14<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></div></figure>\n<h6 id=\"yml配置服务\">yml配置服务<a href=\"2019/11/17/SpringBoot-Zookeeper-Dubbo简单搭建分布式系统#yml配置服务\"></a></h6><figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\"><span class=\"attr\">  port:</span> <span class=\"number\">8081</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">dubbo:</span></span><br><span class=\"line\"><span class=\"attr\">  application:</span></span><br><span class=\"line\">    <span class=\"comment\"># 当前应用的名称</span></span><br><span class=\"line\"><span class=\"attr\">    name:</span> <span class=\"string\">provider</span></span><br><span class=\"line\"><span class=\"attr\">  registry:</span></span><br><span class=\"line\">    <span class=\"comment\"># 注册中心地址</span></span><br><span class=\"line\"><span class=\"attr\">    address:</span> <span class=\"attr\">zookeeper://127.0.0.1:2181</span></span><br><span class=\"line\"><span class=\"attr\">  scan:</span></span><br><span class=\"line\">    <span class=\"comment\"># 扫描包下的服务</span></span><br><span class=\"line\"><span class=\"attr\">    base-packages:</span> <span class=\"string\">com\\ecin520\\provider\\service</span></span><br></pre></td></tr></table></div></figure>\n\n<h6 id=\"编写服务\">编写服务<a href=\"2019/11/17/SpringBoot-Zookeeper-Dubbo简单搭建分布式系统#编写服务\"></a></h6><p>服务接口</p>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.ecin520.provider.service;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">TicketService</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\">String <span class=\"title\">getTicket</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n<p>实现接口</p>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.ecin520.provider.service.impl;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.ecin520.provider.service.TicketService;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.dubbo.config.annotation.Service;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Component;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Service注解为Dubbo</span></span><br><span class=\"line\"><span class=\"comment\"> * 将类放到容器中</span></span><br><span class=\"line\"><span class=\"comment\"> * 程序启动Dubbo会自动扫描指定包下面<span class=\"doctag\">@Component</span>的类，将其发布到注册中心</span></span><br><span class=\"line\"><span class=\"comment\"> * */</span></span><br><span class=\"line\"><span class=\"meta\">@Service</span></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TicketServiceImpl</span> <span class=\"keyword\">implements</span> <span class=\"title\">TicketService</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getTicket</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">\"Ticket remain 5.\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n<p>这样就写好了一个提供剩余售票的提供者</p>\n<h5 id=\"消费者-consumer\">消费者 consumer<a href=\"2019/11/17/SpringBoot-Zookeeper-Dubbo简单搭建分布式系统#消费者-consumer\"></a></h5><h6 id=\"在pom-xml中添加依赖，和provider一样\">在pom.xml中添加依赖，和provider一样<a href=\"2019/11/17/SpringBoot-Zookeeper-Dubbo简单搭建分布式系统#在pom-xml中添加依赖，和provider一样\"></a></h6><figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- Dubbo Spring Boot Starter --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.dubbo<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>dubbo-spring-boot-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.7.3<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- https://mvnrepository.com/artifact/com.github.sgroschupf/zkclient --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.github.sgroschupf<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>zkclient<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- 引入zookeeper --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.curator<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>curator-framework<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.12.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.curator<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>curator-recipes<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.12.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.zookeeper<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>zookeeper<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.4.14<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></div></figure>\n<h6 id=\"yml配置\">yml配置<a href=\"2019/11/17/SpringBoot-Zookeeper-Dubbo简单搭建分布式系统#yml配置\"></a></h6><figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\"><span class=\"attr\">  port:</span> <span class=\"number\">8082</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">dubbo:</span></span><br><span class=\"line\"><span class=\"attr\">  application:</span></span><br><span class=\"line\">    <span class=\"comment\"># 当前应用名称</span></span><br><span class=\"line\"><span class=\"attr\">    name:</span> <span class=\"string\">consumer</span></span><br><span class=\"line\"><span class=\"attr\">  registry:</span></span><br><span class=\"line\">    <span class=\"comment\"># 注册中心地址</span></span><br><span class=\"line\"><span class=\"attr\">    address:</span> <span class=\"attr\">zookeeper://127.0.0.1:2181</span></span><br></pre></td></tr></table></div></figure>\n<h6 id=\"消费者使用提供者的服务正常步骤一般为打包provider成jar后，然后在consumer的pom中添加依赖，提供给consumer使用。但是为了方便使用，利用一个更简单的方法，在consumer中添加和provider相同的包（路径和名称必须相同）。这样才会不报错。\">消费者使用提供者的服务正常步骤一般为打包provider成jar后，然后在consumer的pom中添加依赖，提供给consumer使用。但是为了方便使用，利用一个更简单的方法，在consumer中添加和provider相同的包（路径和名称必须相同）。这样才会不报错。<a href=\"2019/11/17/SpringBoot-Zookeeper-Dubbo简单搭建分布式系统#消费者使用提供者的服务正常步骤一般为打包provider成jar后，然后在consumer的pom中添加依赖，提供给consumer使用。但是为了方便使用，利用一个更简单的方法，在consumer中添加和provider相同的包（路径和名称必须相同）。这样才会不报错。\"></a></h6><p>提供者</p>\n<p><img src=\"http://148.70.50.70/source/1573992148992.jpg\" alt=\"image.png\" class=\"article-img\"></p>\n<p>消费者</p>\n<p><img src=\"http://148.70.50.70/source/1573992186769.jpg\" alt=\"image.png\" class=\"article-img\"></p>\n<p>消费者代码 UserService</p>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.ecin520.consumer.service;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.ecin520.provider.service.TicketService;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.dubbo.config.annotation.Reference;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.dubbo.config.annotation.Service;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Component;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Service</span></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserService</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 本地调用用的是<span class=\"doctag\">@Autowire</span></span></span><br><span class=\"line\"><span class=\"comment\">     * 远程调用使用的是Dubbo的<span class=\"doctag\">@Reference</span></span></span><br><span class=\"line\"><span class=\"comment\">     * */</span></span><br><span class=\"line\">    <span class=\"meta\">@Reference</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> TicketService ticketService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">queryTicketCount</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ticketService.getTicket();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n<p>编写UserController测试</p>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.ecin520.consumer.controller;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.ecin520.consumer.service.UserService;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserController</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    UserService userService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping</span>(<span class=\"string\">\"/getTickets\"</span>)</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getTickets</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> userService.queryTicketCount();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n<h5 id=\"开始执行程序\">开始执行程序<a href=\"2019/11/17/SpringBoot-Zookeeper-Dubbo简单搭建分布式系统#开始执行程序\"></a></h5><h6 id=\"打开Zookeeper注册中心\">打开Zookeeper注册中心<a href=\"2019/11/17/SpringBoot-Zookeeper-Dubbo简单搭建分布式系统#打开Zookeeper注册中心\"></a></h6><p><img src=\"http://148.70.50.70/source/1573992406093.jpg\" alt=\"image.png\" class=\"article-img\"></p>\n<h6 id=\"运行提供者\">运行提供者<a href=\"2019/11/17/SpringBoot-Zookeeper-Dubbo简单搭建分布式系统#运行提供者\"></a></h6><p><img src=\"http://148.70.50.70/source/1573992473889.jpg\" alt=\"image.png\" class=\"article-img\"></p>\n<h6 id=\"运行消费者\">运行消费者<a href=\"2019/11/17/SpringBoot-Zookeeper-Dubbo简单搭建分布式系统#运行消费者\"></a></h6><p><img src=\"http://148.70.50.70/source/1573992501654.jpg\" alt=\"image.png\" class=\"article-img\"></p>\n<h6 id=\"访问接口\">访问接口<a href=\"2019/11/17/SpringBoot-Zookeeper-Dubbo简单搭建分布式系统#访问接口\"></a></h6><p><img src=\"http://148.70.50.70/source/1573992582226.jpg\" alt=\"image.png\" class=\"article-img\"></p>\n<p>远程调用成功</p>\n<h4 id=\"dubbo-admin查看zookeeper状态\">dubbo-admin查看zookeeper状态<a href=\"2019/11/17/SpringBoot-Zookeeper-Dubbo简单搭建分布式系统#dubbo-admin查看zookeeper状态\"></a></h4><p><a href=\"https://github.com/apache/dubbo-admin\" target=\"_blank\" rel=\"noopener\">https://github.com/apache/dubbo-admin</a></p>\n<p><img src=\"http://148.70.50.70/source/1573993726152.jpg\" alt=\"image.png\" class=\"article-img\"></p>\n<p>修改为zookeeper地址即可，运行后</p>\n<p><img src=\"http://148.70.50.70/source/1573993771567.jpg\" alt=\"image.png\" class=\"article-img\"></p>\n","prev":{"title":"Netty从入门到瞎搞","link":"2019/11/19/Netty从入门到瞎搞"},"next":{"title":"SpringBoot之WebSocket通信","link":"2019/11/14/WebSocket"},"plink":"http://yoursite.com/2019/11/17/SpringBoot-Zookeeper-Dubbo简单搭建分布式系统/"}