{"title":"SpringBoot异常处理","date":"2019-11-06T12:18:07.000Z","link":"2019/11/06/SpringBoot异常处理","tags":["Java","SpringBoot"],"updated":"2019-11-06T15:17:42.000Z","content":"<h6 id=\"有时候异常处理的代码散布在项目代码的各个地方，许多相同的异常处理，有可能在非常多的类中都有出现，这不仅造成了代码冗余，不断编写重复代码，更是增加了代码的耦合性，在后期异常不断增多的情况下，维护起来也是非常的麻烦，于是可以利用AOP的思想统一异常处理。\">有时候异常处理的代码散布在项目代码的各个地方，许多相同的异常处理，有可能在非常多的类中都有出现，这不仅造成了代码冗余，不断编写重复代码，更是增加了代码的耦合性，在后期异常不断增多的情况下，维护起来也是非常的麻烦，于是可以利用AOP的思想统一异常处理。<a href=\"2019/11/06/SpringBoot异常处理#有时候异常处理的代码散布在项目代码的各个地方，许多相同的异常处理，有可能在非常多的类中都有出现，这不仅造成了代码冗余，不断编写重复代码，更是增加了代码的耦合性，在后期异常不断增多的情况下，维护起来也是非常的麻烦，于是可以利用AOP的思想统一异常处理。\"></a></h6><h5 id=\"拿Shiro的Exception来说，在controller中，登陆接口为-login\">拿Shiro的Exception来说，在controller中，登陆接口为/login<a href=\"2019/11/06/SpringBoot异常处理#拿Shiro的Exception来说，在controller中，登陆接口为-login\"></a></h5><figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RequestMapping</span>(<span class=\"string\">\"/login\"</span>)</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">Login</span><span class=\"params\">(@RequestParam(<span class=\"string\">\"username\"</span>)</span> String username,</span></span><br><span class=\"line\"><span class=\"function\">                    @<span class=\"title\">RequestParam</span><span class=\"params\">(<span class=\"string\">\"password\"</span>)</span>String password,</span></span><br><span class=\"line\"><span class=\"function\">                    @<span class=\"title\">RequestParam</span><span class=\"params\">(<span class=\"string\">\"remember\"</span>)</span><span class=\"keyword\">boolean</span> remember)</span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**创建一个subject*/</span></span><br><span class=\"line\">    Subject subject = SecurityUtils.getSubject();</span><br><span class=\"line\">    <span class=\"comment\">/**封装用户数据*/</span></span><br><span class=\"line\">    UsernamePasswordToken token = <span class=\"keyword\">new</span> UsernamePasswordToken(username,password);</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">/**执行登录,然后这里会跳转到Realm的认证逻辑中*/</span></span><br><span class=\"line\">        subject.login(token);</span><br><span class=\"line\">        token.setRememberMe(remember);</span><br><span class=\"line\">        Session session = SecurityUtils.getSubject().getSession();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> session.getId().toString();</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (UnknownAccountException uae) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">\"未知账户\"</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (IncorrectCredentialsException ice) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">\"密码不正确\"</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (LockedAccountException lae) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">\"账户已锁定\"</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (ExcessiveAttemptsException eae) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">\"用户名或密码错误次数过多\"</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (AuthenticationException ae) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">\"用户名或密码不正确！\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n\n<p>可以发现有很多的try…catch语句</p>\n<h5 id=\"新建一个全局异常处理类ExceptionHandle\">新建一个全局异常处理类ExceptionHandle<a href=\"2019/11/06/SpringBoot异常处理#新建一个全局异常处理类ExceptionHandle\"></a></h5><h6 id=\"RestControllerAdvice相当于-ControllerAdvice-ResponseBody，表示这是一个全局异常处理的类。\">@RestControllerAdvice相当于@ControllerAdvice+@ResponseBody，表示这是一个全局异常处理的类。<a href=\"2019/11/06/SpringBoot异常处理#RestControllerAdvice相当于-ControllerAdvice-ResponseBody，表示这是一个全局异常处理的类。\"></a></h6><figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> org.apache.shiro.authc.*;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.shiro.authz.AuthorizationException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.ExceptionHandler;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RestControllerAdvice;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.HashMap;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**定义全局异常处理类</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> NICE*/</span></span><br><span class=\"line\"><span class=\"meta\">@RestControllerAdvice</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ExceptionHandle</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@ExceptionHandler</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">errorHandler</span><span class=\"params\">(AuthorizationException e)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">\"Sorry,you don't have permission.\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@ExceptionHandler</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> HashMap&lt;Integer, String&gt; <span class=\"title\">unknownAccountException</span><span class=\"params\">(UnknownAccountException e)</span></span>&#123;</span><br><span class=\"line\">        HashMap&lt;Integer, String&gt; map = <span class=\"keyword\">new</span> HashMap&lt;&gt;(<span class=\"number\">1</span>);</span><br><span class=\"line\">        map.put(<span class=\"number\">500</span>,<span class=\"string\">\"Unknown Account.\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> map;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@ExceptionHandler</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> HashMap&lt;Integer, String&gt; <span class=\"title\">incorrectCredentialsException</span><span class=\"params\">(IncorrectCredentialsException e)</span></span>&#123;</span><br><span class=\"line\">        HashMap&lt;Integer, String&gt; map = <span class=\"keyword\">new</span> HashMap&lt;&gt;(<span class=\"number\">1</span>);</span><br><span class=\"line\">        map.put(<span class=\"number\">500</span>,<span class=\"string\">\"Password Wrong.\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> map;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@ExceptionHandler</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> HashMap&lt;Integer, String&gt; <span class=\"title\">lockedAccountException</span><span class=\"params\">(LockedAccountException e)</span></span>&#123;</span><br><span class=\"line\">        HashMap&lt;Integer, String&gt; map = <span class=\"keyword\">new</span> HashMap&lt;&gt;(<span class=\"number\">1</span>);</span><br><span class=\"line\">        map.put(<span class=\"number\">500</span>,<span class=\"string\">\"Account Locked.\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> map;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@ExceptionHandler</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> HashMap&lt;Integer, String&gt; <span class=\"title\">excessiveAttemptsException</span><span class=\"params\">(ExcessiveAttemptsException e)</span></span>&#123;</span><br><span class=\"line\">        HashMap&lt;Integer, String&gt; map = <span class=\"keyword\">new</span> HashMap&lt;&gt;(<span class=\"number\">1</span>);</span><br><span class=\"line\">        map.put(<span class=\"number\">500</span>,<span class=\"string\">\"Too Much Input Wrong.\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> map;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@ExceptionHandler</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> HashMap&lt;Integer, String&gt; <span class=\"title\">authenticationException</span> <span class=\"params\">(AuthenticationException e)</span></span>&#123;</span><br><span class=\"line\">        HashMap&lt;Integer, String&gt; map = <span class=\"keyword\">new</span> HashMap&lt;&gt;(<span class=\"number\">1</span>);</span><br><span class=\"line\">        map.put(<span class=\"number\">500</span>,<span class=\"string\">\"Username Or Password Wrong.\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> map;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n\n<h5 id=\"然后如果捕获到相应异常就会返回ExceptionHandle中的异常处理相应的方法。这是一个简单的例子，虽然这样可以简化一些代码，但是这只能处理简单的异常处理，而且仅限于Controller层。\">然后如果捕获到相应异常就会返回ExceptionHandle中的异常处理相应的方法。这是一个简单的例子，虽然这样可以简化一些代码，但是这只能处理简单的异常处理，而且仅限于Controller层。<a href=\"2019/11/06/SpringBoot异常处理#然后如果捕获到相应异常就会返回ExceptionHandle中的异常处理相应的方法。这是一个简单的例子，虽然这样可以简化一些代码，但是这只能处理简单的异常处理，而且仅限于Controller层。\"></a></h5>","next":{"title":"使用lombok注解简化代码开发","link":"2019/11/04/使用lombok注解简化代码开发"},"plink":"http://yoursite.com/2019/11/06/SpringBoot异常处理/"}