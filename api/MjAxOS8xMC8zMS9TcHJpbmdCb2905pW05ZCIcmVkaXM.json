{"title":"'Springboot'","date":"2019-10-31T03:24:16.000Z","link":"2019/10/31/SpringBoot整合redis","tags":["Java","SpringBoot"],"updated":"2019-10-31T08:21:29.886Z","content":"<h1 id=\"Springboot整合redis\">Springboot整合redis<a href=\"2019/10/31/SpringBoot整合redis#Springboot整合redis\"></a></h1><p><img src=\"http://148.70.50.70/source/1571211982004.jpg\" alt=\"image.png\" class=\"article-img\"></p>\n<h4 id=\"pom-xml添加依赖\">pom.xml添加依赖<a href=\"2019/10/31/SpringBoot整合redis#pom-xml添加依赖\"></a></h4><figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;</span><br><span class=\"line\">&lt;/dependency&gt;</span><br></pre></td></tr></table></div></figure>\n\n<a id=\"more\"></a>\n\n<h4 id=\"开启缓存注解\">开启缓存注解<a href=\"2019/10/31/SpringBoot整合redis#开启缓存注解\"></a></h4><p><img src=\"http://148.70.50.70/source/1571211081508.jpg\" alt=\"image.png\" class=\"article-img\"></p>\n<h4 id=\"添加配置类RedisConfig\">添加配置类RedisConfig<a href=\"2019/10/31/SpringBoot整合redis#添加配置类RedisConfig\"></a></h4><figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Configuration</span><br><span class=\"line\">public class RedisConfig &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Bean</span><br><span class=\"line\">    @ConditionalOnMissingBean(name = &quot;redisTemplate&quot;)</span><br><span class=\"line\">    public RedisTemplate&lt;String,Object&gt; redisTemplate(RedisConnectionFactory redisConnectionFactory)&#123;</span><br><span class=\"line\">        Jackson2JsonRedisSerializer&lt;Object&gt; jackson2JsonRedisSerializer = </span><br><span class=\"line\">                new Jackson2JsonRedisSerializer&lt;Object&gt;(Object.class);</span><br><span class=\"line\">        ObjectMapper objectMapper = new ObjectMapper();</span><br><span class=\"line\">        objectMapper.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class=\"line\">        objectMapper.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);</span><br><span class=\"line\">        jackson2JsonRedisSerializer.setObjectMapper(objectMapper);</span><br><span class=\"line\"></span><br><span class=\"line\">        RedisTemplate&lt;String,Object&gt; template = new RedisTemplate&lt;String,Object&gt;();</span><br><span class=\"line\">        template.setConnectionFactory(redisConnectionFactory);</span><br><span class=\"line\">        template.setKeySerializer(jackson2JsonRedisSerializer);</span><br><span class=\"line\">        template.setValueSerializer(jackson2JsonRedisSerializer);</span><br><span class=\"line\">        template.setHashKeySerializer(jackson2JsonRedisSerializer);</span><br><span class=\"line\">        template.setHashValueSerializer(jackson2JsonRedisSerializer);</span><br><span class=\"line\">        template.afterPropertiesSet();</span><br><span class=\"line\">        return template;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Bean</span><br><span class=\"line\">    @ConditionalOnMissingBean(StringRedisTemplate.class)</span><br><span class=\"line\">    public StringRedisTemplate stringRedisTemplate(RedisConnectionFactory redisConnectionFactory)&#123;</span><br><span class=\"line\">        StringRedisTemplate template = new StringRedisTemplate();</span><br><span class=\"line\">        template.setConnectionFactory(redisConnectionFactory);</span><br><span class=\"line\">        return template;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n<h4 id=\"application-yml\">application.yml<a href=\"2019/10/31/SpringBoot整合redis#application-yml\"></a></h4><figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\"><span class=\"attr\">  redis:</span></span><br><span class=\"line\"><span class=\"attr\">    host:</span> <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span></span><br><span class=\"line\"><span class=\"attr\">    port:</span> <span class=\"number\">6379</span></span><br><span class=\"line\"><span class=\"attr\">    jedis:</span></span><br><span class=\"line\"><span class=\"attr\">      pool:</span></span><br><span class=\"line\"><span class=\"attr\">        max-active:</span> <span class=\"number\">8</span></span><br><span class=\"line\"><span class=\"attr\">        max-wait:</span> <span class=\"bullet\">-1</span></span><br><span class=\"line\"><span class=\"attr\">        max-idle:</span> <span class=\"number\">500</span></span><br><span class=\"line\"><span class=\"attr\">        min-idle:</span> <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"attr\">    lettuce:</span></span><br><span class=\"line\"><span class=\"attr\">      shutdown-timeout:</span> <span class=\"number\">0</span></span><br></pre></td></tr></table></div></figure>\n<h4 id=\"使用时需要注入\">使用时需要注入<a href=\"2019/10/31/SpringBoot整合redis#使用时需要注入\"></a></h4><figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Autowired</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> StringRedisTemplate stringRedisTemplate;</span><br></pre></td></tr></table></div></figure>\n\n<h3 id=\"simple-sample\">simple sample<a href=\"2019/10/31/SpringBoot整合redis#simple-sample\"></a></h3><h5 id=\"缓存普通k-v\">缓存普通k-v<a href=\"2019/10/31/SpringBoot整合redis#缓存普通k-v\"></a></h5><figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">redisTemplate.opsForValue().set(<span class=\"string\">\"name\"</span>,<span class=\"string\">\"Jenny\"</span>);</span><br></pre></td></tr></table></div></figure>\n<p>读取k-v</p>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">redisTemplate.opsForValue().get(<span class=\"string\">\"name\"</span>);</span><br></pre></td></tr></table></div></figure>\n<h5 id=\"设置过期时间\">设置过期时间<a href=\"2019/10/31/SpringBoot整合redis#设置过期时间\"></a></h5><figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*15s*/</span></span><br><span class=\"line\">redisTemplate.opsForValue().set(<span class=\"string\">\"name\"</span>, <span class=\"string\">\"Jenny\"</span>, <span class=\"number\">15</span>, TimeUnit.SECONDS);</span><br></pre></td></tr></table></div></figure>\n\n<h5 id=\"对象缓存\">对象缓存<a href=\"2019/10/31/SpringBoot整合redis#对象缓存\"></a></h5><figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">User user = <span class=\"keyword\">new</span> User();</span><br><span class=\"line\">user.setId(<span class=\"string\">\"20172670****\"</span>);</span><br><span class=\"line\">user.setName(<span class=\"string\">\"郭伟\"</span>);</span><br><span class=\"line\">user.setTel(<span class=\"string\">\"1560794****\"</span>);</span><br><span class=\"line\">user.setMoney(<span class=\"number\">500</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">redisTemplate.opsForValue().set(<span class=\"string\">\"user\"</span>,user);</span><br></pre></td></tr></table></div></figure>\n<h5 id=\"读取\">读取<a href=\"2019/10/31/SpringBoot整合redis#读取\"></a></h5><figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">User user = (User)redisTemplate.opsForValue().get(<span class=\"string\">\"user\"</span>);</span><br></pre></td></tr></table></div></figure>\n<h5 id=\"存取List\">存取List<user></user><a href=\"2019/10/31/SpringBoot整合redis#存取List\"></a></h5><figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">List&lt;User&gt; list = userService.getAllUsers();</span><br><span class=\"line\">redisTemplate.opsForValue().set(<span class=\"string\">\"list\"</span>,list);</span><br><span class=\"line\"></span><br><span class=\"line\">List&lt;User&gt; list1 = (List&lt;User&gt;) redisTemplate.opsForValue().get(<span class=\"string\">\"list\"</span>);</span><br><span class=\"line\"><span class=\"keyword\">for</span>(User user1: list1)&#123;</span><br><span class=\"line\">    System.out.println(user1.toString());</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n<p>当然redis的存储结构不止这些<br>string（字符串），hash（哈希），list（列表），set（集合）及zset(sorted set：有序集合)<br><a href=\"https://blog.csdn.net/weixin_40461281/article/details/82011670\" target=\"_blank\" rel=\"noopener\">参考这里</a></p>\n","prev":{"title":"Hello World","link":""},"next":{"title":"'整理了2019年Java面试题（集 合+并发+调优+微服务+spring+Redis）（转载）'","link":"2019/10/31/2019-10-31-整理了2019年Java面试题（集-合+并发+调优+微服务+spring+Redis）（转载）"},"plink":"http://yoursite.com/2019/10/31/SpringBoot整合redis/","toc":[{"title":"Springboot整合redis","id":"Springboot整合redis","index":"1"}]}